<!DOCTYPE html>
<html>
	<head>
		<title>APSIA - Map</title>
		<meta charset="UTF-8">
		<script src="./dates.js"></script>
		<script>
			window.addEventListener("load", () =>
			{
				const CONFIG_PATH = "../bot/config/clock_config.json";
				const time_area = document.getElementById("time_area");

				function fetch_config(on_config)
				{
					function fetch_failed(code)
					{
						console.error(`Failed to fetch clock config. (${code})`);
					}

					fetch(CONFIG_PATH).then((response) =>
					{
						if (response.ok)
						{
							response.json().then((obj) =>
							{
								on_config(obj)
							}).catch(fetch_failed(-1));
						}
						else
						{
							fetch_failed(response.status);
						}
					}).catch(() => fetch_failed(0));
				}

				let config = null;

				function update_time()
				{
					const relative_utctime = Date.now() - new Date(config.time_epoch).getTime();
					const scaled_time = new Date(config.time_start).getTime() + (relative_utctime * config.time_scale);
					time_area.innerText = format_date(scaled_time, config.alt_display_format);
				}

				fetch_config(function(obj)
				{
					config = obj;

					setInterval(update_time, 100);
				});
			});
		</script>
	</head>
	<body>
		<div>
			<span id="time_area"></span>
		</div>
		<div>
			<img src="./map.png"/>
		</div>
	</body>
</html>